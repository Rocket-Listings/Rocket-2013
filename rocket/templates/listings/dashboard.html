{% extends 'marginless.html' %}
{% load static from staticfiles %}
{% load compressed %}
{% load pagination_tags %}
{% load humanize %}
{% load danatime %}

{% block title %}{{ block.super }} dashboard{% endblock %}

{% block css %}
  <style>
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }
  </style>
  {% compressed_css 'dashboard' %}
{% endblock %}

{% block js %}
  {{ block.super }}
  {% compressed_js 'backbone' %}
  {% compressed_js 'dashboard' %}
  <script type="text/javascript">
    $(function() {
      new app.DashboardView({
        collection: new app.Listings($.parseJSON("{{listings|escapejs}}"))
      });
    });
  </script>
{% endblock %}

{% block content %}
  <div id="dashboard">
    {% if first_visit %}
    <div class="alert alert-info clearfix">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      <h4>The<br/> Dashboard</h4>
      This is your Listings Dashboard. Here you can easily review and manage all of your listings, buyers, and messages.
    </div>
    {% endif %}
    <div class="dashboard-header">
      {# <div class="dashboard-header-inner"> #}
        <div class="dashboard-item dashboard-title">
          <div class="h4">The<br>Dashboard</div>
        </div>
        <div class="input-group input-group-sm dashboard-search">
          <input type="search" class="form-control search" data-table="order-table" placeholder="Search"/>
          <span class="input-group-addon dashboard-search-btn"><span class="glyphicon glyphicon-search"></span></span>
        </div>
        <a class="btn btn-primary btn-sm dashboard-refresh-btn phone-hide" href="#">
          <span class="glyphicon glyphicon-repeat"></span>
        </a>
        <a class="btn btn-primary btn-sm disabled dashboard-delete-btn" data-listing-id="" href="#">
          <span class="glyphicon glyphicon-trash"></span>
        </a>
        <a class="btn btn-primary btn-sm dashboard-delete-permanent-btn disabled hide" data-listing-id="" href="#">
          Delete Forever
        </a>
      {# </div> #}
    </div>
    <div class="dashboard-body{% if first_visit %}first-visit{% endif %}">
      <div class="dashboard-filters phone-hide">
        <div class="dashboard-filters-button-wrapper dashboard-filters-all selected">
          <a data-filter-attr="marked" data-filter-val="false" class="dashboard-filters-text">All</a>
        </div>
        <div class="dashboard-filters-button-wrapper dashboard-filters-active">
          <a data-filter-attr="status_lower" data-filter-val="active" class="dashboard-filters-text">Active </a>
        </div>
        <div class="dashboard-filters-button-wrapper dashboard-filters-sold">
          <a data-filter-attr="status_lower" data-filter-val="sold" class="dashboard-filters-text">Sold</a>
        </div>
        <div class="dashboard-filters-button-wrapper dashboard-filters-draft">
          <a data-filter-attr="status_lower" data-filter-val="draft" class="dashboard-filters-text">Draft</a>
        </div>
        <div class="dashboard-filters-button-wrapper dashboard-filters-pending">
          <a data-filter-attr="status_lower" data-filter-val="pending" class="dashboard-filters-text">Pending</a>
        </div>
        <div class="dashboard-filters-button-wrapper dashboard-filters-deleted">
          <a data-filter-attr="marked" data-filter-val="true" class="dashboard-filters-text">Deleted</a>
        </div>
        <div class="keyboard-shortcuts-text">
          <a href="#">Keyboard shortcuts</a>
        </div>
      </div>
      <div class="dashboard-listings phone-full-width">
        <div class="dashboard-listings-header"><strong>Listings</strong></div>
        <div class="dashboard-listings-body">
          <div class="dashboard-listings-inner">
            <div class="dashboard-listings-inner-header">
              <span class="d-title phone-full-width">
                <a class="sort" data-sort="title" href="#">Title
                <span class="sort-toggle glyphicon glyphicon-chevron-down hide"></span>
                </a>
              </span>
              <span class="d-price phone-hide">
                <a class="sort" data-sort="price" href="#">Price
                <span class="sort-toggle glyphicon glyphicon-chevron-down hide"></span>
                </a>
              </span>
              <span class="d-status phone-hide">
                <a class="sort" data-sort="status_lower" href="#">Status
                <span class="sort-toggle glyphicon glyphicon-chevron-down hide"></span>
                </a>
              </span>
              <span class="d-date phone-hide">
                <a class="sort" data-sort="create_date" href="#">Date Listed
                <span class="sort-toggle glyphicon glyphicon-chevron-down"></span>
                </a>
              </span>
            </div>
            <div class="dashboard-listings-message no-listings">No listings to see here.</div>
            <ul class="dashboard-listings-inner-body"></ul>
            <script id="listing-template" type="text/template">
            {% verbatim %}
            {{#listing}}
              <span class="d-title phone-full-width">
                <a class="title phone-full-width">{{ title }}</a>
              </span>
              <span class="price d-price phone-hide">${{ price }}</span>
              {{!<span class="category d-category phone-hide">{{ category }}</span>}}
              <span class="d-status status phone-hide">{{ status_lower }}</span>
              <span class="d-date phone-hide">
                <span class="date hide">{{ create_date }}</span>
                {{ natural_date }}
              </span>
            {{/listing}}
            {% endverbatim %}
            </script>
          </div>
        </div>
      </div>
      <div class="dashboard-inbox phone-hide">
        <div class="dashboard-inbox-header">
          <strong>Inbox</strong><span class="label label-info">{% if unread_messages %}New{% endif %}</span>
        </div>
        <div class="dashboard-inbox-body">
          <div class="dashboard-buyers">
            <div class="dashboard-buyers-header">Potential Buyers</div>
            <div class="dashboard-buyers-message no-buyers" style="display: none;">No one has contacted you about this listing yet. Hang tight! </div>
            <div class="dashboard-buyers-message no-listing-selected">Select a listing row to view its messages.</div>
            <ul class="dashboard-buyers-body"></ul>
            <script id="buyer-template" type="text/template">
              {% verbatim %}
              {{#buyer}}
                <p>{{ name }}</p>
                <!--<p>{{#max_offer}}Offering ${{max_offer}}{{/max_offer}}{{^max_offer}}No offer{{/max_offer}}</p>-->
              {{/buyer}}
              {% endverbatim %}
            </script>
          </div>
          <div class="dashboard-messages">
            <div class="dashboard-messages-header">Messages</div>
            <div class="dashboard-messages-body">
              <div class="dashboard-messages-inner-a">
                <div class="dashboard-messages-inner-b">
                  <div class="dashboard-messages-message no-buyer-selected">Select a buyer to view the associated message thread.</div>             
                  <ul class="dashboard-messages-inner-body"></ul>
                  <div class="dashboard-messages-inner-footer">
                    <form class="dashboard-message-form" style="display: none;">
                      <textarea rows="4" class="form-control" name="content" placeholder="Send a reply..."></textarea>
                      <input type="hidden" name="listing" value="">
                      <input type="hidden" name="buyer" value="">
                      <input type="submit" class="btn btn-primary send-button">
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <script id="message-template" type="text/template">
              {% verbatim %}
              {{#message}}
                <p class="message-time">{{ natural_date }}</p>
                <p class="message-buyer-name">
                  {{#isSeller}}{{ seller_name }}{{/isSeller}}
                  {{^isSeller}}{{ buyer_name }}{{/isSeller}}
                </p>
                <p class="message-content">{{ content }}</p>
              {{/message}}
              {% endverbatim %}
            </script>
          </div>
          {% comment %}
          <span class="dashboard-empty-inbox hide">You have no messages for this listing.</span>
          {% endcomment %}
        </div>
      </div>
    </div>
    <div id="keyboard-shortcuts-modal" class="modal">
      <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Keyboard Shortcuts</h4>
        </div>
        <div class="modal-body">
        <table class="keys pane-1">
          <tr>
            <td><span class="arrow">&darr;</span>/<span class="char">j</span></td>
            <td>Select the next item</td>
          </tr>
          <tr>
            <td><span class="arrow">&uarr;</span>/<span class="char">k</span></td>
            <td>Select the previous item</td>
          </tr>
          <tr>
            <td><span class="arrow">&rarr;</span>/<span class="char">b</span></td>
            <td>Toggle buyers context</td>
          </tr>
          <tr>
            <td><span class="arrow">&larr;</span>/<span class="char">l</span></td>
            <td>Toggle listings context</td>
          </tr>
          <tr>
            <td><span>Enter</span></td>
            <td>Select the first listing from search</td>
          </tr>
          <tr>
            <td><span>Esc</span></td>
            <td>Unfocus the search or new message field</td>
          </tr>
        </table>
        <table class="keys pane-2">
          <tr>
            <td><span class="char">n</span></td>
            <td>Create new listing</td>
          </tr>
          <tr>
            <td><span class="char">/</span></td>
            <td>Search listings</td>
          </tr>
          <tr>
            <td><span class="char">m</span></td>
            <td>Focus new message field</td>
          </tr>
          <tr>
            <td><span class="char">r</span></td>
            <td>Refresh the dashboard</td>
          </tr>
          <tr>
            <td><span class="char">?</span></td>
            <td>Toggle this dialog</td>
          </tr>
        </table>
        </div>
      </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
  </div>
{% endblock %}
