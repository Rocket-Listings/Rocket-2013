{% load static from staticfiles %}
{% load humanize %}
{# Requires the context variable 'messages' #}	

<div class="messages-body">
	{% for message in buyer_messages %}
	<ul class="message buyer-{{ message.buyer.id }} listing-{{ message.listing.id }} {% if message.isSeller %}message-seller{% else %}message-buyer{% endif %} hide">
		<li class="message-time">{{message.date|naturaltime}}</li>
		<li class="message-buyer-name">
			{% if message.isSeller %}
				{% if user.get_profile.name %}
				{{ user.get_profile.name }}
				{% else %}
				{{ user.username }}
				{% endif %}
			{% else %}
				{{ message.buyer.name }}
			{% endif %}

		</li>

		<li class="message-content">{{ message.content }}</li>
	</ul>
	<span class="hide message-form-preserve buyer-{{ message.buyer.id }}"></span>
	{% endfor %}
</div>
<div class="message-form-wrapper hide">
	<form class="message-form">
		<textarea rows="3" class="form-control" name="content" placeholder="Send a reply..."></textarea>
		<input type="hidden" name="listing" value="">
		<input type="hidden" name="buyer" value="">
		<input type="submit" class="btn btn-primary send-button">
	</form>
</div>

<script id="new-message" type="text/template">
{% verbatim %}
{{#messages}}
	<ul class="message buyer-{{ buyer_id }} listing-{{ listing_id }} {{#isSeller}}message-seller{{/isSeller}}{{^isSeller}}message-buyer{{/isSeller}} hide">
		<li class="message-time">{{ date }}</li>
		<li class="message-buyer-name">
			{{#isSeller}}{{ seller_name }}{{/isSeller}}
			{{^isSeller}}{{ buyer_name }}{{/isSeller}}
		</li>
		<li class="message-content">{{ content }}</li>
	</ul>
	<span class="hide message-form-preserve buyer-{{ buyer_id }}"></span>
{{/messages}}
{% endverbatim %}
</script>
