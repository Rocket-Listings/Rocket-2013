{% load static from staticfiles %}
{% load pagination_tags %}

{# Requires the context variable 'listings' #}

{% if listings %}
<table class="table table-striped tablesorter table-condensed table-listings" name="listing-name">
	<thead>
		<tr>
			<th class = "sortable">Title<i class="icon-chevron-down"></i></th>
			<th class = "sortable">Price<i class="icon-chevron-down"></i></th>
			{# <th class = "sortable">Location<i class="icon-chevron-down"></i></th> #}
			<th class = "sortable">Category<i class="icon-chevron-down"></i></th>
			<th class = "sortable">Date Listed<i class="icon-chevron-down"></i></th>
			<th>Max Offer</th>
			<th>Autopost</th>
			<th>Manage</th>	
		</tr>
	</thead>
	<tbody>
		{% autopaginate listings 5 %}
		{% for listing in listings %}
		<tr data-listing-id="{{ listing.id }}" >
			<td class = "clickable">
				<a href="{{ listing.get_absolute_url }}">
					{{ listing.title }}
				</a>
			</td>
			<td class = "clickable">${{ listing.price }}</td>
			{# <td class = "clickable">{{ listing.location }}</td> #}
			<td class = "clickable">{{ listing.category.name }}</td>
			<td class = "clickable">{{ listing.pub_date|date:"m-d-y P" }}</td>
			<td class = "clickable">
				{% if listing.max_offer %}
				<a href = "{% url 'listings.views.offers' listing.id %}">${{listing.max_offer}}</a>				
				{% else %}
				None
				{% endif %}
			</td>
			<td class = "clickable">
				<a href = "{% url 'listings.views.autopost' listing.id %}">Craigslist</a>	
			</td>

			<td> 
				<div class="btn-toolbar">
					<a href="{{ listing.get_absolute_url }}">Link</a>
					<div class="btn-group" data-listing-id="{{ listing.id }}">
						{% comment %}
						<a class="clipboard btn" data-clipboard-text="{% filter force_escape %}{% include "listing_cl_embed.html" %}{% endfilter %}">
							<i class="icon-download"></i>
						</a>
						{% endcomment %}
						<a class="btn" href="{% url 'listings.views.update' listing.id %}" data-container="body" data-toggle="tooltip" data-original-title="Edit Listing">
							<i class="icon-edit"></i>
						</a>
						<!--buyer button 
						<a class="btn" id = "buyer-button" href="" data-container="body" data-toggle="tooltip" data-original-title="See Buyers" data-listing-id="{{ listing.id }}">
							<i class="icon-user"></i>
						</a>
						-->

						<!--modal trigger -->
						<a class = "deleteModal btn" data-listing-id="{{ listing.id }}" href = "#deleteModal" data-toggle = "modal"><i class="icon-trash"></i> </a>
							
						<!-- modal -->
						<div id="deleteModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="delete" aria-hidden="true">
						  <div class="modal-header">
						    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
						    <h3 id="myModalLabel">Delete listing?</h3>
						  </div>
						  <div class="modal-body">
						    <h5>If you delete the listing, it will no longer appear on Rocket Listings or <br> Craigslist. You can restore the listing by going to your deleted listings panel.</h5>
						  </div>
						  <div class="modal-footer">
						    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
						    <a class="btn btn-primary" href="{% url 'listings.views.delete' listing.id %}" data-container="body">Confirm</a>
						  </div>
						</div>

					</div>
				</div>
			</td>
			{% comment %}
			<td class = "centered-td">
				
				<a href = "{{listing.CL_link}}" target="_blank">
					<img src="{% static 'img/cl_icon.png' %}" width = "25" height = "25" class = "grey"></i>
				</a>
				{% else %}
				<td class = "centered-td"> N/A </td>
				
			</td> 
			{% endcomment %}
		</tr>
		
		
		{% endfor %}
		<a href="/listings/category/">New Listing</a>
		
	</tbody>
</table>
{% else %}
<h4>You don't have any listings yet! <a href="{% url 'listings.views.create' %}">Let's get started making one.</a></h4>
<h4>Remember you can always just create a listing on Craigslist with your <code class="text-info">{{user.username}}@rocketlistings.mailgun.org</code> email and manage it here.</hr>
{% endif %}
{% paginate %}